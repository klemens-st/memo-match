function shuffle(e){for(var t,s,r=e.length;0!==r;)s=Math.floor(Math.random()*r),t=e[r-=1],e[r]=e[s],e[s]=t;return e}function storageAvailable(e){try{var t=window[e],s="__storage_test__";return t.setItem(s,s),t.removeItem(s),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==t.length}}const gameController={goal:8,matched:0,deck:document.querySelector(".deck"),openCards:[],init(){this.deckSetup(),this.setEvents(),scoreController.resetScore(),leaderBoard.init(),modal.init()},setEvents(){this.deck.addEventListener("click",e=>{"DIV"===e.target.nodeName&&!1===e.target.classList.contains("open")&&e.target!==e.currentTarget&&gameController.openCard(e.target)}),document.querySelector(".btn-reset").addEventListener("click",()=>{gameController.started&&gameController.reset();const e=document.querySelector(".btn-start");e.classList.toggle("started"),e.disabled=!0})},start(){this.started=!0,this.deck.classList.toggle("reveal"),timer.start()},reset(){this.matched=0,this.deckSetup(),scoreController.resetScore(),timer.stop(),timer.reset(),timer.start()},deckSetup(){const e=document.createDocumentFragment();let t=[];["☀","☂","☏","☘","☮","♥","♫","☺"].forEach((e,s)=>{const r=document.createElement("div");r.innerHTML=`<span>${e}</span>`,r.dataset.pairId=s,t.push(r),t.push(r.cloneNode(!0))}),(t=shuffle(t)).forEach(t=>{e.appendChild(t)}),this.deck.innerHTML="",this.deck.appendChild(e)},openCard(e){this.openCards.push(e),e.classList.toggle("open"),this.evaluate()},evaluate(){if(2!==this.openCards.length)return;scoreController.incrementCounter();const e=this.openCards[0],t=this.openCards[1];e.dataset.pairId===t.dataset.pairId?this.processMatch():this.processMiss(),this.openCards=[]},processMatch(){this.matched+=1,this.openCards.forEach(e=>{setTimeout(()=>{e.classList.toggle("matched")},500)}),this.matched===this.goal&&this.victory()},processMiss(){this.openCards.forEach(e=>{setTimeout(()=>{e.classList.toggle("wrong")},500),setTimeout(()=>{e.classList.toggle("open"),e.classList.toggle("wrong")},1e3)})},victory(){timer.stop(),setTimeout(()=>{modal.open()},1e3)}},scoreController={counter:document.querySelector(".counter"),stars:document.querySelector(".stars"),starSymbols:{filled:"★",empty:"☆"},resetScore(){this.moves=0,this.rating=3,this.breakPoints=[20,24,30],this.counter.textContent="0",this.renderStars()},incrementCounter(){this.moves+=1,this.counter.textContent=this.moves,this.assignStars()},assignStars(){this.moves>this.breakPoints[0]&&(this.rating-=1,this.breakPoints.shift(),this.renderStars())},renderStars(){const e=this.starSymbols.filled,t=this.starSymbols.empty,s=[`${t} ${t} ${t}`,`${e} ${t} ${t}`,`${e} ${e} ${t}`,`${e} ${e} ${e}`];this.stars.textContent=s[this.rating]}},timer={current:0,el:document.querySelector(".timer"),parse(){let e=Math.floor(this.current/3600),t=Math.floor(this.current/60%60),s=this.current%60;return e<10&&(e="0"+e),t<10&&(t="0"+t),s<10&&(s="0"+s),`${e}:${t}:${s}`},start(){this.interval=setInterval(()=>{this.current+=1,this.el.textContent=timer.parse()},1e3)},stop(){clearInterval(this.interval)},reset(){this.current=0,this.el.textContent=this.parse()}},leaderBoard={el:document.querySelector(".leaderboard"),list:document.querySelector(".scores > tbody"),form:document.querySelector(".modal form"),available:!1,noScores:!0,init(){if(storageAvailable("localStorage")){this.available=!0;const e=localStorage.getItem("leaderBoard");this.scores=null!==e?JSON.parse(e):[],this.render(),this.setEvents()}else document.querySelector(".leaderboard").classList.toggle("disabled"),this.form.classList.toggle("disabled")},setEvents(){this.form.addEventListener("submit",e=>{e.preventDefault();const t=document.querySelector("input").value;leaderBoard.insert(t)});const e=document.querySelector(".clear-scores > button");e.addEventListener("pointerdown",()=>{leaderBoard.timeout=setTimeout(()=>{leaderBoard.clear()},5e3)}),e.addEventListener("pointerup",()=>{clearInterval(leaderBoard.timeout)})},insert(e){const t={name:e,time:(new Date).toLocaleString(),score:scoreController.moves};let s=!1;if(0<this.scores.length)for(const e of this.scores)if(e.score>=t.score){const r=this.scores.indexOf(e);this.scores.splice(r,0,t),s=!0;break}0!==this.scores.length&&s||this.scores.push(t),localStorage.setItem("leaderBoard",JSON.stringify(this.scores)),this.form.classList.toggle("disabled"),this.render()},render(){if(this.toggleNoScores(),0===this.scores.length)return;const e=document.createDocumentFragment();let t=1;this.scores.forEach(s=>{const{name:r,time:o,score:a}=s,i=document.createElement("tr");i.innerHTML=`<td>${t}.</td><td>${r}</td><td>${a}</td><td>${o}</td>`,e.appendChild(i),t++}),this.list.classList.toggle("hidden"),this.list.innerHTML="",this.list.appendChild(e),this.list.classList.toggle("hidden")},toggleNoScores(){(0===this.scores.length&&!this.noScores||0<this.scores.length&&this.noScores)&&(this.noScores=!this.el.querySelector(".no-scores").classList.toggle("disabled"),document.querySelector(".clear-scores").classList.toggle("disabled"))},clear(){this.scores=[],localStorage.removeItem("leaderBoard"),this.list.innerHTML="",this.render()}},modal={el:document.querySelector(".modal"),overlay:document.querySelector(".overlay"),init(){this.el.querySelector(".again").addEventListener("click",()=>{modal.close(),gameController.reset()}),this.el.querySelector(".close").addEventListener("click",()=>{modal.close();const e=document.querySelector(".btn-start");e.classList.toggle("started"),e.disabled=!1})},open(){this.render(),this.overlay.classList.toggle("disabled"),this.toggleBlur()},close(){this.overlay.classList.toggle("disabled"),leaderBoard.available&&leaderBoard.form.classList.remove("disabled"),this.toggleBlur()},render(){const e=this.el.querySelector(".moves"),t=this.el.querySelector(".stars"),s=this.el.querySelector(".timer");e.textContent=scoreController.moves,t.textContent=scoreController.rating,t.textContent+=1===scoreController.rating?" star":" stars",s.textContent=timer.parse()},toggleBlur(){document.body.classList.toggle("blur")}};gameController.init(),document.querySelector(".btn-start").addEventListener("click",function(){gameController.started?gameController.reset():gameController.start(),this.classList.toggle("started"),this.disabled=!0});